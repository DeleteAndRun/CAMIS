---
title: "Estimating Cumulative Incidence Functions Using R"
---

## Objective

In this document we present how to estimate cumulative incidence functions (CIFs) for the probability of experiencing a certain event at a given time in a competing risks model in R. We focus on the basic model where each subject experiences only one out of *k* possible events as depicted in the figure below.

```{r, echo=FALSE, fig.align='center', out.width="75%"}
knitr::include_graphics("../images/survival_competing_risks/cr.jpg")
```

In addition, we are interested in R packages and functions that are relatively easy to implement, and provide analyses and results comparable to those given by SAS.

## R Packages for Estimating CIFs

We have identified two packages, one a wrapper of the other, that can be considered "counter-parts" of the SAS procedure LIFETEST, a default choice for estimating CIFs. The two packages are:

-   `cmprsk` version 2.2-12 (2024-05-14)
-   `tidycmprsk` version 1.0.0 (2023-10-30).

They are tested using R version 4.3.1 (2023-06-16) on platform x86_64-pc-linux-gnu (64-bit).

### Data used

The bone marrow transplant (BTM) dataset as presented by Guo & So (2018) is used. The dataset has the following variables:

-   `Group` has three levels, indicating three disease groups.

-   `T` is the disease-free survival time in days. A derived variable `TYears = T/365.25` is used in the analysis.

-   `Status` has value 0 if `T` is censored; 1 if `T` is time to relapse; 2 if `T` is time to death.

-   `WaitTime` is the waiting time to transplant in days. A log transformation is applied to stabilize the large variation.

```{r readdata, message=FALSE, warning=FALSE}
require(dplyr)
bmt <- read.delim(paste0(getwd(), "../data/bmt.txt")) %>%
  mutate(Group = factor(Group, 
                        levels = c(1, 2, 3), 
                        labels = c('ALL', 'AML-Low Risk', 'AML-High Risk')
                        ),
         Status = factor(Status,
                         levels = c(0, 1, 2),
                         labels = c('Censored', 'Relapse', 'Death')),
         TYears = T / 365.25
         )
```

## Estimating the CIFs

### CIF Estimates and Gray's Test

```{r}
bmt.cif <- cmprsk::cuminc(ftime = bmt$TYears, 
                          fstatus = bmt$Status, 
                          group = bmt$Group, 
                          cencode = 'Censored')
print(bmt.cif, ntp = 4, maxtime = 5)
cmprsk::timepoints(bmt.cif, c(0.5, 1, 1.5, 2, 4))
```

The function `cuminc{cmprsk}` does not provide confidence intervals for the estimated CIF. The `tidycmprsk`

estimates the variance of the CIF estimates based on the asymptotic variance of Aalen (1978).

### Confidence Intervals for the Estimated CIF

## Conclusion

**Optional** add a conclusion

## Reference

Aalen O. (1978). Nonparametric estimation of partial transition probabilities in multiple decrement models, ANNALS OF STATISTICS, 6:534-545.

Guo C and So Y. (2018). "Cause-specific analysis of competing risks using the PHREG procedure." In Proceedings of the SAS Global Forum 2018 Conference. Cary, NC: SAS Institute Inc. https://support.sas.com/resources/papers/proceedings18/2159-2018.pdf.

Package 'cmprsk' vignettes: https://cran.r-project.org/web/packages/cmprsk/cmprsk.pdf

Pintilie M. (2006). https://onlinelibrary.wiley.com/doi/10.1002/9780470870709.app2 

Sjoberg DD and Fei T. (2023). tidycmprsk: Competing Risks Estimation.  https://github.com/MSKCC-Epi-Bio/tidycmprsk